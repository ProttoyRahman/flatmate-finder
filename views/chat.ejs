<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const chatId = "<%= chat._id %>";
  const userId = "<%= userId %>";

  // Join the chat room
  socket.emit('joinChat', chatId);

  const form = document.getElementById('chatForm');
  const input = document.getElementById('msgInput');
  const messagesDiv = document.getElementById('messages');

  // Send a new message
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    if (input.value.trim() !== '') {
      socket.emit('chatMessage', { chatId, senderId: userId, content: input.value });
      input.value = '';
    }
  });

  // Listen for new messages from the server
  socket.on('newChatMessage', (msg) => {
    if (msg.chatId === chatId) {
      const p = document.createElement('p');
      p.innerHTML = `<strong>${msg.sender._id === userId ? 'You' : msg.sender.name}:</strong> ${msg.content}`;
      messagesDiv.appendChild(p);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  });
</script>
